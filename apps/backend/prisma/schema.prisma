generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Core Product Model (The root of the chain)
model Product {
  id        String   @id @default(uuid())
  barcode   String   @unique
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  variantSection1s VariantSection1[]
}

// Section 1: Product Identity (Name, Brand, Image)
model VariantSection1 {
  id             String   @id @default(uuid())
  productId      String
  name           String
  brand          String?
  image          String? // URL to the image
  score          Int      @default(0) // Confidence score
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  // Relations
  product         Product           @relation(fields: [productId], references: [id])
  variantSection2s VariantSection2[]
  votes           Vote[]
}

// Section 2: Nutritional Info & Ingredients (Dependent on Section 1)
model VariantSection2 {
  id                String   @id @default(uuid())
  variantSection1Id String
  ingredients       String?  // Text content
  nutritionTable    Json?    // JSONB for flexible nutrition data (energy, protein, etc.)
  score             Int      @default(0)
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  // Relations
  variantSection1 VariantSection1 @relation(fields: [variantSection1Id], references: [id])
  votes           Vote[]
}

// Voting System
model Vote {
  id                String   @id @default(uuid())
  userId            String   // From Google Auth
  variantSection1Id String?
  variantSection2Id String?
  voteType          VoteType // UPVOTE (Correct) or DOWNVOTE (Incorrect)
  createdAt         DateTime @default(now())

  // Relations
  variantSection1 VariantSection1? @relation(fields: [variantSection1Id], references: [id])
  variantSection2 VariantSection2? @relation(fields: [variantSection2Id], references: [id])
}

enum VoteType {
  UPVOTE
  DOWNVOTE
}
